"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var e=require("react"),n=t(e),r=require("react-dom");require("prop-types");var i=t(require("invariant"));function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],a=Object.getOwnPropertyDescriptor(e,i);a&&a.configurable&&void 0===t[i]&&Object.defineProperty(t,i,a)}}(t,e),t})(t,e)}function l(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}function u(t){return requestAnimationFrame(t)}function s(t){cancelAnimationFrame(t)}function c(t){if(!t)return!1;var e=t.ownerDocument;return e.hasFocus()&&e.activeElement===t}function f(t){return null==t?void 0:t.ownerDocument}function h(t){var e=function(t){var e;return null==(e=f(t))?void 0:e.defaultView}(t);return!!e&&t instanceof e.HTMLElement}function g(t){return e.useCallback((function(){var e=t.current,n="undefined"!=typeof window&&h(e);if(!e||!n)return null;if("INPUT"!==e.nodeName&&(e=e.querySelector("input")),!e)throw new Error("react-input-mask: inputComponent doesn't contain input node");return e}),[t])}function v(t,n){var r,i,a,o,l=e.useRef({start:null,end:null}),f=g(t),h=e.useCallback((function(){var t=f();if(t)return function(t){var e=t.selectionStart,n=t.selectionEnd;return{start:e,end:n,length:n-e}}(t)}),[f]),v=e.useCallback((function(){return l.current}),[]),d=e.useCallback((function(t){var e=f();e&&c(e)&&(!function(t,e,n){void 0===n&&(n=e),t.setSelectionRange(e,n)}(e,t.start,t.end),l.current=h())}),[f,h]),p=e.useCallback((function(){l.current=h()}),[h]),m=(r=p,i=e.useRef(null),a=e.useCallback((function(){null===i.current&&function t(){r(),i.current=u(t)}()}),[r]),o=e.useCallback((function(){s(i.current),i.current=null}),[]),e.useEffect((function(){i.current&&(o(),a())}),[a,o]),e.useEffect(s,[]),[a,o]),P=m[0],k=m[1];return e.useLayoutEffect((function(){if(n){var t=f();return t&&(t.addEventListener("focus",P),t.addEventListener("blur",k)),c(t)&&P(),function(){t&&(t.removeEventListener("focus",P),t.removeEventListener("blur",k)),k()}}})),{getSelection:h,getLastSelection:v,setSelection:d}}function d(t,n){var r=e.useRef(),i=v(r,n),a=i.getSelection,o=i.getLastSelection,l=i.setSelection,u=function(t,n){var r=g(t),i=e.useRef(n);return{getValue:e.useCallback((function(){var t=r();return t?t.value:void 0}),[r]),getLastValue:e.useCallback((function(){return i.current}),[]),setValue:e.useCallback((function(t){i.current=t;var e=r();e&&(e.value=t)}),[r])}}(r,t),s=u.getValue,c=u.getLastValue,f=u.setValue;return{inputRef:r,getInputState:function(){return{value:s(),selection:a()}},getLastInputState:function(){return{value:c(),selection:o()}},setInputState:function(t){var e=t.value,n=t.selection;f(e),l(n)}}}require("warning");var p=["disabled","onBlur","onChange","onFocus","onMouseDown","readOnly","value"],m={"#":/[0-9]/,9:/[0-9]/,a:/[A-Za-z]/,x:/[A-Za-z]/,"*":/[A-Za-z0-9]/};var P=function(t){var e=this;this.isCharacterAllowedAtPosition=function(t,n){var r=e.maskOptions.maskPlaceholder;return!!e.isCharacterFillingPosition(t,n)||!!r&&r[n]===t},this.isCharacterFillingPosition=function(t,n){var r=e.maskOptions.mask;if(!t||n>=r.length)return!1;if(!e.isPositionEditable(n))return r[n]===t;var i=r[n];return new RegExp(i).test(t)},this.isPositionEditable=function(t){var n=e.maskOptions,r=n.mask,i=n.permanents;return t<r.length&&-1===i.indexOf(t)},this.isValueEmpty=function(t){return t.split("").every((function(t,n){return!e.isPositionEditable(n)||!e.isCharacterFillingPosition(t,n)}))},this.isValueFilled=function(t){return e.getFilledLength(t)===e.maskOptions.lastEditablePosition+1},this.getDefaultSelectionForValue=function(t){var n=e.getFilledLength(t),r=e.getRightEditablePosition(n);return{start:r,end:r}},this.getFilledLength=function(t){return function(t,e){for(var n=t.length-1;n>=0;n--){if(e(t[n],n))return n}return-1}(t.split(""),(function(t,n){return e.isPositionEditable(n)&&e.isCharacterFillingPosition(t,n)}))+1},this.getStringFillingLengthAtPosition=function(t,n){return t.split("").reduce((function(t,n){return e.insertCharacterAtPosition(t,n,t.length)}),function(t,e){void 0===e&&(e=1);for(var n="",r=0;r<e;r++)n+=t;return n}(" ",n)).length-n},this.getLeftEditablePosition=function(t){for(var n=t;n>=0;n--)if(e.isPositionEditable(n))return n;return null},this.getRightEditablePosition=function(t){for(var n=e.maskOptions.mask,r=t;r<n.length;r++)if(e.isPositionEditable(r))return r;return null},this.formatValue=function(t){var n=e.maskOptions,r=n.maskPlaceholder,i=n.mask;if(!r){for(t=e.insertStringAtPosition("",t,0);t.length<i.length&&!e.isPositionEditable(t.length);)t+=i[t.length];return t}return e.insertStringAtPosition(r,t,0)},this.clearRange=function(t,n,r){if(!r)return t;var i=n+r,a=e.maskOptions,o=a.maskPlaceholder,l=a.mask,u=t.split("").map((function(t,r){var a=e.isPositionEditable(r);return!o&&r>=i&&!a?"":r<n||r>=i?t:a?o?o[r]:"":l[r]})).join("");return e.formatValue(u)},this.insertCharacterAtPosition=function(t,n,r){var i=e.maskOptions,a=i.mask,o=i.maskPlaceholder;if(r>=a.length)return t;var l=e.isCharacterAllowedAtPosition(n,r),u=e.isPositionEditable(r),s=e.getRightEditablePosition(r),c=o&&s?n===o[s]:null,f=t.slice(0,r);!l&&u||(t=f+(l?n:a[r]));return l||u||c||(t=e.insertCharacterAtPosition(t,n,r+1)),t},this.insertStringAtPosition=function(t,n,r){var i=e.maskOptions,a=i.mask,o=i.maskPlaceholder;if(!n||r>=a.length)return t;var l=n.split(""),u=e.isValueFilled(t)||!!o,s=t.slice(r);if(t=l.reduce((function(t,n){return e.insertCharacterAtPosition(t,n,t.length)}),t.slice(0,r)),u)t+=s.slice(t.length-r);else if(e.isValueFilled(t))t+=a.slice(t.length).join("");else{t=s.split("").filter((function(t,n){return e.isPositionEditable(r+n)})).reduce((function(t,n){var r=e.getRightEditablePosition(t.length);return null===r?t:(e.isPositionEditable(t.length)||(t+=a.slice(t.length,r).join("")),e.insertCharacterAtPosition(t,n,t.length))}),t)}return t},this.processChange=function(t,n){var r=e.maskOptions,i=r.mask,a=r.prefix,o=r.lastEditablePosition,l=t.value,u=t.selection,s=n.value,c=n.selection,f=l,h="",g=0,v=0,d=Math.min(c.start,u.start);if(u.end>c.start?(h=f.slice(c.start,u.end),v=(g=e.getStringFillingLengthAtPosition(h,d))?c.length:0):f.length<s.length&&(v=s.length-f.length),f=s,v){if(1===v&&!c.length)d=c.start===u.start?e.getRightEditablePosition(u.start):e.getLeftEditablePosition(u.start);f=e.clearRange(f,d,v)}return f=e.insertStringAtPosition(f,h,d),(d+=g)>=i.length?d=i.length:d<a.length&&!g?d=a.length:d>=a.length&&d<o&&g&&(d=e.getRightEditablePosition(d)),{value:f=e.formatValue(f),enteredString:h,selection:{start:d,end:d}}},this.maskOptions=function(t){var e=t.formatChars,n=t.mask,r=t.maskPlaceholder,i=[],o=a({},m,e);if(!n)return{maskPlaceholder:null,mask:null,prefix:null,lastEditablePosition:null,permanents:[]};if("string"==typeof n){var l=!1,u="";n.split("").forEach((function(t){l||"\\"!==t?(!l&&o[t]||i.push(u.length),u+=t,l=!1):l=!0})),n=u.split("").map((function(t,e){return-1===i.indexOf(e)?o[t]:t}))}else n.forEach((function(t,e){"string"==typeof t&&i.push(e)}));r&&(r=1===r.length?n.map((function(t,e){return-1!==i.indexOf(e)?t:r})):r.split(""),i.forEach((function(t){r[t]=n[t]})),r=r.join(""));for(var s=i.filter((function(t,e){return t===e})).map((function(t){return n[t]})).join(""),c=n.length-1;-1!==i.indexOf(c);)c--;return{maskPlaceholder:r,prefix:s,mask:n,lastEditablePosition:c,permanents:i}}(t)},k=["children"],b=function(t){var e,r;function i(){return t.apply(this,arguments)||this}return r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,o(e,r),i.prototype.render=function(){var t=this.props,e=t.children,r=l(t,k);return(n.cloneElement(e,r))},i}(n.Component),E=["alwaysShowMask","beforeMaskedStateChange","children","formatChars","mask","maskPlaceholder"],C=e.forwardRef((function(t,o){var s=t.alwaysShowMask,h=t.beforeMaskedStateChange,v=t.children,m=t.formatChars,k=t.mask,C=t.maskPlaceholder,S=l(t,E);!function(t){var e=t.mask,n=t.maskPlaceholder;e&&n&&1!==n.length&&n.length!==e.length&&i(!1)}(t);var y,O,w=new P({formatChars:m,mask:k,maskPlaceholder:C}),V=!!k,F=!S.disabled&&!S.readOnly,L=null!==t.value&&void 0!==t.value,A=(y=V,O=e.useRef(),e.useEffect((function(){O.current=y})),O.current),R=d(function(t){return""+t}((L?t.value:t.defaultValue)||""),V),x=R.inputRef,M=R.getInputState,j=R.setInputState,D=R.getLastInputState,I=g(x);if(V&&L){var q=I(),N=q&&c(q)||s||t.value?w.formatValue(t.value):t.value;h&&(N=h({nextState:{value:N,selection:{start:null,end:null}}}).value),j(a({},D(),{value:N}))}var B=D(),T=B.selection,z=B.value;e.useLayoutEffect((function(){if(V){var t=c(I()),e=T,n=M(),r=a({},n);if(!L){var i=n.value,o=w.formatValue(i),l=w.isValueEmpty(o);!l||t||s?r.value=o:l&&!t&&(r.value="")}t&&!A?r.selection=w.getDefaultSelectionForValue(r.value):L&&t&&e&&null!==e.start&&null!==e.end&&(r.selection=e),h&&(r=h({currentState:n,nextState:r})),j(r)}}));var Z=a({},S,{onFocus:function(e){x.current=e.target;var n=M().value;if(V&&!w.isValueFilled(n)){var r=w.formatValue(n),i=w.getDefaultSelectionForValue(r),a={value:r,selection:i};h&&(r=(a=h({currentState:M(),nextState:a})).value,i=a.selection),j(a),r!==n&&t.onChange&&t.onChange(e),u((function(){j(D())}))}t.onFocus&&t.onFocus(e)},onBlur:function(e){var n=M().value,r=D().value;if(V&&!s&&w.isValueEmpty(r)){var i="",a={value:i,selection:{start:null,end:null}};h&&(i=(a=h({currentState:M(),nextState:a})).value),j(a),i!==n&&t.onChange&&t.onChange(e)}t.onBlur&&t.onBlur(e)},onChange:V&&F?function(e){var n=M(),r=D(),i=w.processChange(n,r);h&&(i=h({currentState:n,previousState:r,nextState:i})),j(i),t.onChange&&t.onChange(e)}:t.onChange,onMouseDown:V&&F?function(e){var n=I(),r=M().value,i=f(n);if(i&&!c(n)&&!w.isValueFilled(r)){var o=e.clientX,l=e.clientY,u=(new Date).getTime();i.addEventListener("mouseup",(function t(e){if(i.removeEventListener("mouseup",t),c(n)){var r=Math.abs(e.clientX-o),s=Math.abs(e.clientY-l),f=Math.max(r,s),h=(new Date).getTime()-u;if(f<=10&&h<=200||f<=5&&h<=300){var g=D(),v=a({},g,{selection:w.getDefaultSelectionForValue(g.value)});j(v)}}}))}t.onMouseDown&&t.onMouseDown(e)}:t.onMouseDown,ref:function(t){x.current=r.findDOMNode(t),!function(t){return"function"==typeof t}(o)?null!==o&&"object"==typeof o&&(o.current=t):o(t)},value:V&&L?z:t.value});return v?(function(t,e){p.filter((function(n){return null!=e.props[n]&&e.props[n]!==t[n]})).length&&i(!1)}(t,v),n.createElement(b,Z,v)):n.createElement("input",Z)}));C.displayName="InputMask",C.defaultProps={alwaysShowMask:!1,formatChars:{},maskPlaceholder:"_"},module.exports=C;
